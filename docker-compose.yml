version: "2"
services:
    app:
        # use the Dockerfile next to this file
        build:
            context: .
            # build with Dockerfile
            dockerfile: ./.docker/containers/app/Dockerfile

        # sources environment variable configuration for our app
        env_file:
            - ./docker/docker.env
            - ./docker/containers/app/app.env

        # Reference app to /home/app (Should be copied for production)
        volumes:
            - ./app:/home/app

        # expose the port we configured for the app
        ports:
            - "4545"

    # service configuration for our web server
    web:
        # use the Dockerfile next to this file
        build:
            context: .
            # build with Dockerfile
            dockerfile: ./.docker/containers/web/Dockerfile

        # sources environment variable configuration for our app
        env_file:
            - ./docker/docker.env
            - ./docker/containers/web/web.env

        # makes the web container aware of the app container
        links:
            - app

        # persist SSL certificates
        volumes:
            - ssl:/var/www/ssl

        # expose the port we configured Nginx to bind to
        ports:
            - "80:80"
            - "443:443"

volumes:
    ssl: {}